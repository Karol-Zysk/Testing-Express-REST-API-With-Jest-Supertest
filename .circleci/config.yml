version: 2.1

jobs:
  build:
    docker:
      - image: circleci/node

    steps:
      - checkout
      # convert variables to ssh format
      - run:
          name: Convert private key to RSA
          command: |
            ssh-keygen -f PRIVATE_KEY -m 'PEM' -t 'RSA' -q -N ''
            ssh-keygen -f PUBLIC_KEY -m 'PEM' -t 'RSA' -q -N ''

      # Install TypeScript
      - run: sudo npm install -g typescript

      # Install project dependencies
      - run: npm install

      # Compile TypeScript source code
      - run: npm run build

      # Run tests
      - run: npm run test

      # Deploy on render
